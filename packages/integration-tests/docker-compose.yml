services:
  localosmosis:
    container_name: localosmosis
    build:
      context: ./docker-resources/localosmosis
    ports:
      - "127.0.0.1:26657:26657"
      - "127.0.0.1:1317:1317"
      - "127.0.0.1:9090:9090"
      - "127.0.0.1:9091:9091"
    volumes:
      - ./local-workspace:/var/workspace

  postgres:
    container_name: postgres
    image: "postgres:16"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: postgres
    ports:
      - "127.0.0.1:45921:5432"

  kademlia-validators:
    image: ubuntu:noble
    volumes:
      - ../../target/release:/host:ro
    command: ["/host/kademlia-discovery", "validators", "5400"]

  kademlia-client:
    image: ubuntu:noble
    volumes:
      - ../../target/release:/host:ro
    depends_on:
      - kademlia-validators
    command:
      ["/host/kademlia-discovery", "client", "/ip4/127.0.0.1/udp/5400/quic-v1"]
